const{db:db}=require("../../../../db.js");var productDetailSQL="\n        SELECT \n          P.id, \n          P.name, \n          P.description,\n          P.code,\n          P.instock,\n          P.onspecial,\n          P.showonline,\n          \n          --product main image\n          IFNULL(M.id, 0) AS imgid,\n          IFNULL(MU.id, 0) AS imgusedid,\n          CASE \n              WHEN M.id IS NOT NULL THEN\n                  '/static/images/'|| M.name ||'/medium'|| M.ext\n              ELSE ''\n          END AS imgpath,\n\n          --product normal prices\n          IFNULL(PP1.id, 0) AS normalpriceid,\n          IFNULL(PP1.price, 0.00) as normalprice,\n      \n          --product special prices\n          IFNULL(PP2.id, 0) AS specialpriceid,\n          IFNULL(PP2.price, 0.00) as specialprice,\n          PP2.specialdateStart,\n          PP2.specialdateEnd\n\n      FROM products AS P\n      LEFT JOIN media_used MU ON MU.id = P.mediaused_id AND MU.deleted_yn=0\n      LEFT JOIN media M ON M.id = MU.media_id AND M.deleted_yn=0\n      LEFT JOIN product_prices PP1 ON PP1.products_id = P.id AND PP1.isspecial=0 AND PP1.deleted_yn = 0\n      LEFT JOIN product_prices PP2 ON PP2.products_id = P.id AND PP2.isspecial=1 AND PP2.deleted_yn = 0          \n      WHERE P.deleted_yn = 0 AND P.showonline = 1\n    ";function getProductsHTML(req,res){const products=db.prepare(productDetailSQL).all();res.setHeader("Content-Security-Policy","script-src 'self' 'unsafe-inline'"),res.render("./frontend/pages/productpages/products",{title:"Products",layout:"frontend/layout/main",products:products})}function getProductHTML(req,res){const product=db.prepare(productDetailSQL+" AND P.id=:id").get({id:req.params.id});if(!product)return res.status(404).send("Not Found.");res.setHeader("Content-Security-Policy","script-src 'self' 'unsafe-inline'"),res.render("./frontend/pages/productpages/product",{title:product.name,layout:"frontend/layout/main",product:product})}module.exports={getProductsHTML:getProductsHTML,getProductHTML:getProductHTML};