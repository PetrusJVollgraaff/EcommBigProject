const express=require("express"),path=require("path"),router=express.Router(),passport=require("passport"),csurf=require("csurf"),projectRoot=path.join(__dirname,"../..");router.use("/static",express.static(path.join(projectRoot,"/views/backend"))),router.use(csurf()),router.use(((req,res,next)=>{res.locals.csrfToken=req.csrfToken(),next()})),router.use(((err,req,res,next)=>{if(err&&"EBADCSRFTOKEN"===err.code)return res.status(403).send("Form tampered with");res.status(500).send("Internal Server Error")})),router.get("/",((req,res)=>{res.render("./backend/pages/login",{layout:"backend/layout/login",title:"login"})})),router.post("/login",((req,res,next)=>{passport.authenticate("local",((err,user,info)=>err?next(err):user?void req.logIn(user,(err=>err?next(err):(console.log("Login successful:",user.username),res.redirect("../modules/")))):(console.log("Login failed:",info),res.redirect("./"))))(req,res,next)})),router.get("/logout",((req,res,next)=>{req.logout((err=>{if(err)return next(err);res.redirect("/edit")}))})),module.exports=router;